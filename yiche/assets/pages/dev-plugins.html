<!DOCTYPE html>
<!--[if IE 8]>
<html lang="zh-CN" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="zh-CN" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh-CN" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="../global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="../global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
    <link href="../global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
    <link rel="stylesheet" type="text/css" href="../global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
    <!-- END PAGE LEVEL PLUGIN STYLES -->

    <!-- BEGIN THEME STYLES -->
    <link href="../global/css/components.css" id="style_components" rel="stylesheet" type="text/css"/>
    <link href="../global/css/plugins.css" rel="stylesheet" type="text/css"/>
    <link href="../admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
    <link href="../admin/layout/css/themes/blue.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="../admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="../global/img/favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-container-bg-solid page-iframe">
<!-- BEGIN PAGE HEADER-->
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="page-bar">
                <ul class="page-breadcrumb">
                    <li>
                        <i class="fa fa-home"></i>
                        <a href="../../index.html">Home</a>
                        <i class="fa fa-angle-right"></i>
                    </li>
                    <li>
                        <a href="javascript:;" id="wdj-bread-menu"></a>
                        <i class="fa fa-angle-right"></i>
                    </li>
                    <li>
                        <a href="javascript:;" id="wdj-bread-title"></a>
                        <i class="fa fa-angle-right"></i>
                    </li>
                    <li>
                        <a href="javascript:;" id="wdj-bread-detail"></a>
                    </li>
                </ul>
                <div class="page-toolbar">
                </div>
            </div>
            <h3 class="page-title" id="wdj-page-detail">

            </h3>
            <!-- END PAGE HEADER-->

        </div>
        <div class="col-md-12 padding-big-top">
            <!-- BEGIN EXAMPLE TABLE PORTLET-->
            <div class="portlet box blue-dark">
                <div class="portlet-title" style="position: relative;">
                    <div class="caption">
                        <i class="fa fa-list"></i> Details Table
                    </div>
                    <div class="tools">
                        <a href="javascript:;" class="collapse">
                        </a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="table-toolbar">
                    </div>
                    <table class="table table-striped table-bordered table-hover" id="wdj-datatable">
                        <thead>
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                类别
                            </th>
                            <th>
                                名称
                            </th>
                            <th>
                                接触时间
                            </th>
                            <th>
                                仓库
                            </th>
                            <th>
                                备注
                            </th>
                            <th>
                                熟练程度
                            </th>
                            <th>
                                操作
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <!--ajax data set-->
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- END EXAMPLE TABLE PORTLET-->
        </div>
    </div>
</div>
<!-- END CONTENT -->

<!--搜索数据列表-->
<datalist id="dtList"></datalist>

<!--模态框-->
<div class="modal fade" id="project-details-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Item details</h4>
            </div>
            <div class="modal-body">
                <table class="table table-hover table-striped">
                    <thead>
                    <tr>
                        <th>Initiator</th>
                        <th>Description</th>
                        <th>Online</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td id="modal-initiator"></td>
                        <td id="modal-desc"></td>
                        <td id="modal-online"></td>
                    </tr>
                    </tbody>
                </table>
                <h4 class="font-grey text-center">bugs</h4>
                <table class="table table-hover table-striped">
                    <thead>
                    <tr>
                        <th>Id</th>
                        <th>Description</th>
                        <th>Solution</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr id="modal-bugs">
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="../global/plugins/respond.min.js"></script>
<script src="../global/plugins/excanvas.min.js"></script>
<![endif]-->
<script src="../global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="../global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<script src="../global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="../global/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="../global/scripts/base.js" type="text/javascript"></script>
<script src="../admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="../admin/layout/scripts/custom.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script>
    jQuery(document).ready(function () {
        Base.init(); // init base core componets
        Layout.init(); // init layout
        hkcustom.init();

        //init bread
        var _param = hkcustom.getURLParameter();
        if (Object.keys(_param).length == 3) {
            $("#wdj-bread-menu").html(_param.menu);
            $("#wdj-bread-title").html(_param.title);
            $("#wdj-bread-detail, #wdj-page-detail").html(_param.detail);
        } else {
            var _top_doc = $(window.top.document);
            $("#wdj-bread-menu").html(_top_doc.find("#topMenubar .active a").text());
            $("#wdj-bread-title").html(_top_doc.find(".leftMenubar.active > a .title").text());
            $("#wdj-bread-detail, #wdj-page-detail").html(_top_doc.find(".leftMenubar.active li.active a").text());
        }

        //init datatable
        (function () {
            var table = $('#wdj-datatable'),
                category,
                urlPre = "http://localhost:80/";

            function getJsonCategory(index) {
                for (var i = 0; i < category.length; i++) {
                    if (!!category[i][index]) {
                        return category[i][index];
                    }
                }
                return "未分类";
            }

            //配置文件
            $.getJSON("../json/config.json", function (data) {
                urlPre = data.domain + ":" + data.port + "/";
            });

            //分类文件
            $.getJSON("../json/dev/plugins/category.json", function (data) {
                category = data;
                (function (cate) {
                    var iHtml = '';
                    for (var i = 0; i < cate.length; i++) {
                        iHtml += "<option value='" + category[i][Object.keys(category[i])[0]] + "'>";
                    }
                    $("#dtList").html(iHtml);
                })(data);
            });

            // begin first table debugDt.fnFilter过滤("keywords").fnDraw重绘()
            window.debugDt = table.dataTable({

                "processing": true, //显示处理进度
                "deferRender": true, //延迟加载
                "bStateSave": true, // save datatable state(pagination, sort, etc) in cookie.
                "ajax": {
                    "url": "../json/dev/plugins/projects.json",
                    "dataSrc": "data"
                },
                "columns": [
                    { "data": "id" },
                    { "data": "category" },
                    { "data": "title" },
                    { "data": "start_date" },
                    { "data": "end_date" },
                    { "data": "note" },
                    { "data": "status" }, //0未上线 1已上线 2作废
                    { "data": null }
                ],
                "columnDefs": [ //自定义列数据
                    {
                        "render": function (data) {
                            return getJsonCategory(data);
                        },
                        "targets": 1
                    },
                    {
                        "render": function (data, type, row) {
                            return "<a href='" + urlPre + row.localhost + "' target='_blank'>" + data + "</a>";
                        },
                        "targets": 2
                    },
                    {
                        "render": function (data) {
                            var _class = '', _text = '';
                            switch (data){
                                case 0:
                                    _text = "否";
                                    break;
                                case 1:
                                    _class = "font-green";
                                    _text = "是";
                                    break;
                                case 2:
                                    _class = "font-red";
                                    _text = "作废";
                                    break;
                                default: break;
                            }
                            return "<span class='" + _class + "'>" + _text + "</span>";
                        },
                        "targets": -2 //倒数第二列
                    },
                    {
                        "visible": true,
                        "targets": [3]
                    },
                    {
                        "data": null,
                        "defaultContent": "<button class='btn btn-default btn-xs'>详情</button>",
                        "targets": -1
                    }
                ],
                "order": [
                    [0, "desc"]
                ], // set first column as a default sort by desc
                "language": {
                    "paginate": {
                        "previous": "prev",
                        "next": "next"
                    }
                },
                "lengthMenu": [
                    [5, 15, 20, -1],
                    [5, 15, 20, "All"] // change per page values here
                ],
                // set the initial value
                "pageLength": 15,
                "pagingType": "bootstrap_full_number"
            });

            var tableWrapper = jQuery('#wdj-datatable_wrapper');

            //定义datalist
            debugDt.on("init.dt", function () {
                $("#wdj-datatable_filter input").attr("list", "dtList");
            }).on("click", "tbody > tr", function (e) {
                if ($(e.target).is("a[href]")) {
                    return;
                }
                var project_id = $(this).find("td:first").html(), project_data, bugs_html = "";
                //获取详细信息
                $.getJSON("../json/dev/plugins/projects.json", function (data) {
                    project_data = data.data[data.data.length - parseInt(project_id)];
                    var $project = $("#project-details-modal"), _online = project_data.details.online ? "查看" : "";
                    $project.find("#modal-desc").html(project_data.details.desc);
                    $project.find("#modal-initiator").html(project_data.details.initiator);
                    $project.find("#modal-online").html('<a href="' + project_data.details.online + '" target="_blank">'+ _online +'</a>');

                    for (var i = 0, j = project_data.details.bugs.length; i < j; i++) {
                        var _status = project_data.details.bugs[i].resolve == 0 ? "未解决" : "<span class='font-green'>已解决</span>";
                        bugs_html += '<td>' + (i + 1) + "</td>" +
                                     '<td>' + project_data.details.bugs[i].title + "</td>" +
                                     '<td>' + project_data.details.bugs[i].solution + "</td>" +
                                     '<td>' + _status + '</td>';
                    }
                    $project.find("#modal-bugs").html(bugs_html);
                    $project.modal("show");
                });
            })

            $(document).on("click", "#wdj-datatable_filter input", function (e) {
                $(this).select();
            });

            table.find('.group-checkable').change(function () {
                var set = jQuery(this).attr("data-set");
                var checked = jQuery(this).is(":checked");
                jQuery(set).each(function () {
                    if (checked) {
                        $(this).attr("checked", true);
                        $(this).parents('tr').addClass("active");
                    } else {
                        $(this).attr("checked", false);
                        $(this).parents('tr').removeClass("active");
                    }
                });
                jQuery.uniform.update(set);
            });

            table.on('change', 'tbody tr .checkboxes', function () {
                $(this).parents('tr').toggleClass("active");
            });

            tableWrapper.find('.dataTables_length select').addClass("form-control input-xsmall input-inline"); // modify table per page dropdown
        })();
    });
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>