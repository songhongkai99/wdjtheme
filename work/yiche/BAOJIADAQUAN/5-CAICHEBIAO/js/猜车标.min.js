(function($){$.fn.end=function(){return this.prevObject||$()};$.fn.andSelf=function(){return this.add(this.prevObject||$())};"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(property){var fn=$.fn[property];$.fn[property]=function(){var ret=fn.apply(this,arguments);ret.prevObject=this;return ret}})})(Zepto);(function($){window.Bitauto_caichebiao=function(){var settings={isEveryInterval:true,leftSeconds:15,doubleSeconds:0,timeInterval:1e3,loadedTimedout:200,windowOnloadShow:"#page-start",beforePlay:function(){},afterClick:function(){},errorClick:function(){this.addClass("error").siblings().removeClass("error")},correctClick:function(){this.addClass("correct")},stopPlay:function(){this.find("[data-correct]").addClass("correct")}};var timeInterval=null;function ShowLayer(element){$(element).siblings().addClass("vis-hide").end().removeClass("vis-hide")}var _initWindowOnload=function(options){$.extend(settings,options);Bitauto_caichebiao.settings=settings;var $loadingLogo=$("#loading-logo"),$loadingTextEm=$("#loading-text").children("em"),loadingInterval=null;$loadingLogo.on("load",function(){$(this).css("opacity","1")});$loadingLogo.attr("src",$loadingLogo.attr("src"));var i=1,text;loadingInterval=setInterval(function(){i==4&&(i=1);text="";for(var j=0;j<i;j++){text+="."}$loadingTextEm.text(text);i++},300);$(window).on("load",function(){setTimeout(function(){clearInterval(loadingInterval);ShowLayer(settings.windowOnloadShow)},settings.loadedTimedout)});$(document).on("click","a[href]",function(e){var attrHref=$(this).attr("href");if(attrHref.indexOf("javascript:")<0){e.preventDefault();location=attrHref}});$("#page-playing").on("scroll touchmove",function(e){e.preventDefault();return false}).on("touchstart",function(e){settings.timePaused=e.timeStamp}).on("touchend",function(e){settings.leftSeconds-=(e.timeStamp-settings.timePaused)/1e3})};var _initButtonFunc=function(){function _eventFunc(){$(".this-brand",$("#page-playing-play")).on("click",_initSelectBrand);settings.beforePlay.call();setTimeout(function(){ShowLayer("#page-playing");ShowLayer("#page-playing-play > section:first-child");_initPlayingStatus(0)},200)}$("#this-start").on("click",function(){_eventFunc()}).on({touchstart:function(){$(this).addClass("js-click")},touchend:function(){$(this).removeClass("js-click")},touchcancel:function(){$(this).removeClass("js-click")}});function showSharePop(ele){$(ele).removeClass("vis-hide").one("click",function(){$(this).addClass("vis-hide")})}$("#this-xuanyao").on("click",function(){showSharePop("#popup-layer")});$("#this-download").on("click",function(){showSharePop("#popup-layer")});$("#this-yaoqing").on("click",function(){showSharePop("#popup-layer2")})};var _initPlayingStatus=function(index){timeInterval&&clearInterval(timeInterval);parseInt(index)>=0||(index=0);var $currentSection=$("#page-playing-play").children().eq(index),currentLevel=$currentSection.data("level"),currentBrand=$currentSection.data("brand"),secondsEm=$("#this-seconds").children("em"),levelEm=$("#this-level").children("em"),brandEm=$("#this-brand").children("em");secondsEm.parent().removeClass("red");if(settings.isEveryInterval){settings.leftSeconds=parseFloat($currentSection.data("seconds"));secondsEm.text(settings.leftSeconds)}levelEm.text(currentLevel);brandEm.text(currentBrand);timeInterval=setInterval(function(){settings.leftSeconds-=settings.timeInterval/1e3;if(settings.leftSeconds<=3){secondsEm.parent().addClass("red")}if(settings.leftSeconds<settings.doubleSeconds){settings.leftSeconds=settings.leftSeconds.toFixed(2);secondsEm.text("0"+settings.leftSeconds)}else{secondsEm.text(settings.leftSeconds.toFixed(0))}if(settings.leftSeconds<=0){secondsEm.text("0");_stopPlaying($currentSection)}},settings.timeInterval)};var _initSelectBrand=function(e){var $eventTarget=$(e.target),$eventSection=$(e.target).closest("section"),rightstop=parseFloat($eventSection.data("rightstop"));if($eventTarget.data("correct")){settings.correctClick.call($eventTarget);_initNextStep($eventSection)}else{settings.errorClick.call($eventTarget);if(!!rightstop&&settings.leftSeconds>rightstop){var $secondsEm=$("#this-seconds").children("em");settings.leftSeconds-=rightstop;settings.leftSeconds<=3&&$secondsEm.parent().addClass("red");$secondsEm.text(settings.leftSeconds.toFixed(0))}else{_stopPlaying($eventSection,false)}}settings.afterClick.call($eventSection)};var _initNextStep=function(section){if(section.next().length==0){_stopPlaying(section,true)}else{setTimeout(function(){ShowLayer(section.next());_initPlayingStatus(section.next().index())},100)}};var _stopPlaying=function(section,isCorrect){clearInterval(timeInterval);$(".this-brand",$("#page-playing-play")).off("click");var level=0;if(!isCorrect){if(section.prev().length!=0){level=parseInt(section.prev().data("level"))}}else{level=parseInt(section.data("level"))}switch(level){case 0:case 1:case 2:case 3:_failPlaying(level);break;case 4:case 5:case 6:case 7:case 8:case 9:case 10:_successPlaying(level);break;default:break}settings.stopPlay.call(section)};var _successPlaying=function(level){location.href="win.html?level="+level};var _failPlaying=function(level){location.href="fail.html?level="+level};var _redirectPage=function(level){location.href="xxx.do?level="+level};return{init:function(options){_initWindowOnload(options);_initButtonFunc()}}}()})(Zepto);